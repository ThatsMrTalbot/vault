{{#if encoded_token}}
  <div class="box is-marginless is-shadowless">
    <div class="message is-list">
      <div class="message-body">
        <h4 class="title is-7 is-uppercase is-marginless">
          Encoded Operation Token
        </h4>
        <code class="is-word-break">{{encoded_token}}</code>
      </div>
    </div>
    <p>
      If you entered a One Time Password, you can use the Vault CLI to decode the Token:
    </p>
    <div class="message is-list">
      <div class="message-body">
        <h4 class="title is-7 is-uppercase is-marginless">
          DR Operation Token Command
        </h4>
        <code class="is-word-break">
          vault operator generate-root -otp="[enter your otp here]" -decode="{{encoded_token}}"
        </code>
      </div>
    </div>
    {{#copy-button
      clipboardText=(concat 'vault operator generate-root -otp="<enter your otp here>" -decode="' encoded_token '"')
      class="button is-compact"
      buttonType="button"
      success=(action (set-flash-message 'CLI command copied!'))
    }}
      Copy CLI command
    {{/copy-button}}
  </div>
  <div class="box is-marginless is-shadowless">
    {{#copy-button
      clipboardText=encoded_token
      class="button is-primary"
      buttonType="button"
      success=(action (set-flash-message 'OTP copied!'))
    }}
      Copy Encoded Operation Token
    {{/copy-button}}
    <button type="button" class="button" {{action 'clearToken'}}>
      Clear Token
    </button>
  </div>
{{else if (and generateAction (not started))}}
  <form {{action 'startGenerate' (hash otp=otp pgp_key=pgp_key) on="submit"}} id="shamir">
    <div class="box is-marginless is-shadowless">
      {{message-error errors=errors}}
      {{#if (eq generateStep 'chooseMethod')}}
        <p>
        Updating or promoting this cluster requires an operation token. Let's generate one by 
        inputting the master key shares. To get started you'll need to generate a One Time Password
        (OTP) or supply a PGP Key to encrypt the resultant operation token.
        </p>
        <div class="box is-shadowless field is-grouped is-grouped-centered">
          <div class="control">
            <button type="button" class="button is-primary" {{action (mut generateWithPGP) true}}>
              Supply PGP Key
            </button>
          </div>
          <div class="control">
            <span class="button is-white is-static">
              or
            </span>
          </div>
          <div class="control">
            <button type="button" class="button is-primary" {{action "generateOTP"}}>
              Generate OTP
            </button>
          </div>
        </div>
      {{/if}}

      {{#if (eq generateStep 'providePGPKey')}}
        {{pgp-file index='' key=pgpKeyFile onChange=(action 'setKey')}}
        <div class="box is-marginless is-shadowless">
          <button type="button" class="button" {{action "reset"}}>
            Back
          </button>
        </div>
      {{/if}}
      {{#if (eq generateStep 'beginGenerationWithPGP')}}
        <div class="field is-grouped">
          <div class="control">
          <button type="button" class="button" {{action "reset"}}>
            Back
          </button>
          </div>
          <div class="control">
          <button type="submit" disabled={{and (not pgp_key) (not otp)}} class="button is-primary">
            Generate Operation Token
          </button>
          </div>
        </div>
      {{/if}}
      {{#if (eq generateStep 'beginGenerationWithOTP')}}
        <p>
          Below is the generated OTP. This will be used to encrypt the generated Operation Token.
          <em class="has-text-danger has-text-weight-semibold">
            Make sure to save this, as you will need it later to decrypt the Operation Token.
          </em>
          Next we'll enter portions of the master key to generate an Operation Token. Click the "Generate Operation Token" button to proceed.
        </p>
        <div class="message is-list has-copy-button" tabindex="-1">
          <HoverCopyButton @copyValue=otp />
          <div class="message-body">
            <h4 class="title is-7 is-uppercase is-marginless">
              One Time Password
            </h4>
            <code class="is-word-break">{{otp}}</code>
          </div>
        </div>
        <div class="control">
          {{#copy-button
            clipboardText=otp
            class="button is-compact"
            buttonType="button"
            success=(action (set-flash-message 'OTP copied!'))
          }}
            Copy OTP
          {{/copy-button}}
        </div>
        <div class="field is-grouped">
          <div class="control">
          <button type="button" class="button" {{action "reset"}}>
            Back
          </button>
          </div>
          <div class="control">
          <button type="submit" disabled={{and (not pgp_key) (not otp)}} class="button is-primary">
            Generate Operation Token
          </button>
          </div>
        </div>
      {{/if}}
    </div>
  </form>
{{else}}
  <form {{action 'onSubmit' (hash key=key) on="submit"}} id="shamir">
    <div class="box is-shadowless no-padding-bottom is-marginless">
      {{message-error errors=errors}}
      {{#if hasBlock}}
        {{yield}}
      {{else}}
        <p>{{formText}}</p>
      {{/if}}
    </div>
    <div class="box is-marginless is-shadowless">
      <div class="field">
        <label for="key" class="is-label">
          Master Key Portion
        </label>
        <div class="control">
          {{input class="input"type="password" name="key" value=key data-test-shamir-input=true}}
        </div>
      </div>
    </div>
    <div class="box is-marginless is-shadowless">
      <div class="columns is-mobile">
        <div class="column is-narrow">
          <button
            type="submit"
            class="button is-primary"
            disabled={{loading}}
            data-test-shamir-submit=true
          >
            {{if generateAction "Generate Token" buttonText}}
          </button>
        </div>
        <div class="column is-flex-v-centered is-flex-end">
          {{#if (or started hasProgress)}}
            <ShamirProgress
              @threshold={{threshold}}
              @progress={{progress}}
            />
          {{/if}}
        </div>
      </div>
    </div>
  </form>
{{/if}}
